name: 'release'

on:
  push:
    branches:
      - 'master'    

jobs:
  bump-version:
    name: 'Bump Version on master'
    runs-on: ubuntu-latest

    steps:
      - name: 'Checkout source code'
        uses: 'actions/checkout@v2'
        with:
          ref: ${{ github.ref }}

      # - name: 'cat package.json'
      #   run: cat ./package.json

      # - name: 'Automated Version Bump'
      #   id: version-bump
      #   uses: 'phips28/gh-action-bump-version@master'
      #   with:
      #     major-wording:  'major,MAJOR'
      #     minor-wording:  'minor,MINOR'
      #     patch-wording:  'patch,PATCH,fixes'     # Providing patch-wording will override commits
      #     rc-wording:     'release,RELEASE'
      #     preid: 'rc'
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # - name: 'cat package.json'
      #   run: cat ./package.json

      # - name: 'Output new tag'
      #   env:
      #     NEW_TAG: ${{ steps.version-bump.outputs.newTag }}
      #   run: echo "new tag $NEW_TAG"

      - uses: actions/setup-node@v3
        with:
          node-version: 14
          registry-url: 'https://registry.npmjs.org'

      - name: get changelog
        id: predeploy
        run: |
            npm install
            npm run predeploy
            
      - name: Create a Release
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        # run: gh release create ${{ steps.package-version.outputs.current-version}} --target master -p
        run: |
          if [[ ${{ steps.predeploy.outputs.prerelease }} == 'true' ]]; then IS_PRERELEASE="-p"; else IS_PRERELEASE=""; fi
          echo $IS_PRERELEASE
          gh release create ${{ steps.predeploy.outputs.version }} --target master $IS_PRERELEASE --notes '${{ steps.predeploy.outputs.changeLog }}'
